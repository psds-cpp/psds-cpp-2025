[cow]: https://en.wikipedia.org/wiki/Copy-on-write

# Коровья строка

Существуют разные подходы к управлению данными при копировании. Можно выделить 
следующие семантики:

- value-семантика - при копировании объекта происходит глубокое копирование (deep copy), 
  все значения полностью объекта полностью копируются (реализовано в большинстве классов
  стандартной библиотеки C++).
- reference-семантика - при копировании объекта его содержимое не копируется, 
  а разделяется между копиями посредством ссылки или указателя. Также существует подход,
  который называют поверхностное копирование (shallow copy), когда происходит
  копирование только верхнего уровня оригинального объекта, а ссылки на внутренние 
  части объекта остаются общими (реализовано по умолчанию в некоторых других языках). 
- [cow]-семантика (copy-on-write) - при копировании объекта создается shallow copy, 
  что позволяет использовать объект на чтение без дополнительных затрат ресурсов, но 
  при изменении объекта создается настоящая глубокая копия и изменения вносятся уже в копию.
  Таким образом, копирование совершается только при внесении изменений, что в 
  определенных сценариях использования объекта позволяет увеличить производительность 
  и уменьшить затраты на ресурсы. 

Cow-семантика применяется в реализации строк Яндекса и фреймворка Qt.

Необходимо реализовать класс `CowString`, который представляет собой упрощенную
реализацию строки с copy-on-write семантикой.

Класс предоставляет следующий функционал:

- Конструктор по умолчанию — создает пустую строку
- Конструктор от `const char*`
- Конструктор от `std::string`
- Конструктор копирования — увеличивает счетчик ссылок, не копирует данные
- Оператор присваивания копированием — увеличивает счетчик ссылок, не копирует данные
- Конструктор перемещения
- Оператор присваивания перемещением
- Деструктор

Методы **НЕ** вызывающие копирования:

- Метод `Size` - возвращает длину строки без учета терминирующего нуля `\0`
- Метод `ToCstr` - возвращает указатель на данные
- Метод `ToString` - возвращает `std::string`
- Оператор `[]` - доступ к символу для чтения
- Оператор неявного преобразования к C-строке

Методы, обеспечивающие модификацию на собственной копии данных:

- Оператор `[]` - доступ к символу для записи
- Метод `Append` - добавляет строку из C-строки или `std::string`
- Метод `Substr` - принимает позицию и количество символов (по умолчанию от начала 
  до конца строки), возвращает соответствующую подстроку. Если позиция начала 
  превышает длину, то возвращаем пустую строку.
- Метод `Clear` - очистка строки

Для реализации строки удобно вынести все необходимые поля в отдельную структуру
и кроме этого хранить в ней счетчик ссылок `ref_count`.

Правильно поддерживая `ref_count` всегда будет известно, когда нужно удалять
данные строки или когда нужно превращать shallow-copy в deep-copy.

## Примечание

- **Запрещено** использовать `std::string` в реализации и умные указатели
- Рекомендуется определять методы вне класса
- При необходимости вспомогательные методы реализуются в закрытой части класса
- Тесты оператор `[]` не проверяют на индекс вне диапазона

## Проблемы реализации

- В предполагаемой реализации имеется следующая проблема: при использовании 
  модифицирующей версии оператора `[]` пользователь может сохранить ссылку 
  и модифицировать символ позже, что нарушит cow-семантику. Для упрощения
  решать её не требуется. В Qt используют `QCharRef` для решения этой проблемы.
